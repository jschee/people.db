<%= form_with model: @contact do |f| %>

  <div class="mb-16">
    <div class="w-full border-b relative">
      <div class="rounded-full bg-gray-400 h-24 w-24 flex justify-center items-center absolute" style="top: -3em; left: 43.5%;">
        <div class="relative">
          <div id="avatar">
            <% if @contact.avatar.present? %>
              <%= image_tag(@contact.avatar, class: "rounded-full w-24 h-24") %>
            <% else %>
              <svg id="avatar-placeholder" fill="none" viewBox="0 0 24 24" stroke="#fafafa" class="user w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <% end %>
          </div>

        </div>
        <div class="absolute" style="right: 10%; bottom: -2px;">
            <%= f.label :avatar, '', class: 'h-5 w-5 bg-white rounded-full shadow flex justify-center items-center focus:outline-none hover:bg-green-100 cursor-pointer' do %>
              <%= f.file_field :avatar, accept: 'image/jpeg', onchange: 'previewImage(this);' %>
              <svg viewBox="0 0 20 20" fill="currentColor" class="pencil w-3 h-3"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg>
            <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="flex">
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 mr-2">
      <%= f.text_field :first_name, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :first_name, 'First Name', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 ml-2">
      <%= f.text_field :last_name, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :last_name, 'Last Name', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
  </div>
  <div class="flex">
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 mr-2">
      <%= f.text_field :email, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :email, 'Email Address', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 ml-2">
      <%= f.text_field :phone_number, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :phone_number, 'Phone Number', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
  </div>
  <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2">
    <%= f.text_field :personal_website, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
    <%= f.label :personal_website, 'Personal Website', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
  </div>

    <span class="pb-6 relative">
      <label class="absolute bg-white p-1 duration-300 origin-0 text-sm" style="bottom: -1em; left:0.8em; z-index: 9999">
        Tags
      </label>
    </span>
    <input name='contact[tags]' class='tagify-custom text-lg' placeholder='write some tags' value='<%= @contact.tags.map(&:name).join(", ") %>'></input>

  <hr>
  <br>
  <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2">
    <%= f.date_field :birthday, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
    <%= f.label :birthday, 'Birthday', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
  </div>

  <hr>
  <br>

  <div class="flex">
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 mr-2">
      <%= f.text_field :city, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :city, 'City', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 ml-2">
      <%= f.text_field :state, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :state, 'State/Province', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>

  </div>
  <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 p-4" style="width: 68%">
    <%= f.select :country, Contact::COUNTRIES_LIST,  class: "block p-4 text-lg appearance-none outline-none", placeholder: "" %>
    <%= f.label :country, 'Country', class: "absolute top-0 bg-white p-1 z-1 duration-300 origin-0 text-sm", style: "top: -16px; left: 2%" %>
  </div>

  <div class="flex">
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 mr-2">
      <%= f.text_field :address_1, class: "block p-4 w-full text-lg appearance-none hover:outline-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :address_1, 'Address 1', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 ml-2">
      <%= f.text_field :address_2, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :address_2, 'Address 2', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
  </div>

  <hr>
  <br>


  <div class="flex">
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 mr-2">
      <%= f.text_field :occupation, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :occupation, 'Occupation', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
    <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 ml-2">
      <%= f.text_field :industry, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
      <%= f.label :industry, 'Industry', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
    </div>
  </div>
  <div class="outline relative border-2 focus-within:border-blue-400 mt-2 mb-6 w-1/2 mr-2">
    <%= f.text_field :company_website, class: "block p-4 w-full text-lg appearance-none focus:outline-none bg-transparent", placeholder: "" %>
    <%= f.label :company_website, 'Company Website', class: "absolute top-0 text-lg bg-white p-4 -z-1 duration-300 origin-0" %>
  </div>

  <br>

  <div class="flex justify-between items-center">
    <%= f.submit 'save_contact', class: ' bg-blue-500 hover:bg-blue-400 text-white py-4 px-10 rounded hover:shadow-sm', data: { disable_with: "saving..." } %>
    <% if @contact.slug.present? %>
      <%= link_to 'delete_contact', contact_path(slug: @contact.slug), method: :delete, data: { confirm: "Are you sure you want to delete #{@contact.first_name}?", disable_with: 'deleting...', slug: @contact.slug }, class: "delete-note bg-red-500 hover:bg-red-400 text-white p-2 rounded hover:shadow-sm text-xs" %>
    <% end %>
  </div>
<% end %>


<script>
  function previewImage(e) {
    var fileList = e.files
    var last_image = fileList[fileList.length - 1]
    var file = URL.createObjectURL(last_image);
    var placeholder = document.querySelector('#avatar-placeholder');
    var avatar = document.querySelector('#avatar');
    if (file) {
      if (placeholder) {
        placeholder.style.display = 'none';
      }
      avatar.innerHTML = '<img src="' + file + '" class="rounded-full object-cover h-24 w-24" />';
    }
  }

  var tags = <%= raw @tags.to_json %>;
  var input = document.querySelector('input[name="contact[tags]"]'),
    tagify = new Tagify(input, {
      whitelist: tags,
      dropdown : {
        position: 'text',
        enabled: 1
      },
  })
</script>


